<!DOCTYPE HTML>
    
  <head>
   <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
   <title>ᏏᏉᏯ Numerals - Cherokee
   </title>

   <style type="text/css">
     p.ImageBorder {border-style: dotted;}
     img.ImageBorder {border-style: solid; width: 25px;}
     .notosans {font-size: 12px; }  
   </style>

  <link rel="stylesheet" type="text/css" href="/css/fonts.css">

  <script type="text/javascript" src="/js/calculator.js"> </script>
  <script type="text/javascript" src="/js/calcTest.js"> </script>
  <script type="text/javascript" src="/js/calcTestStates.js"> </script>

  <script type="text/javascript" src="/js/chrNumerals.js"> </script>

  <script type="text/javascript">
  
  // Global Finite State Machine for the calculator.
  calcFSM = null;
  
  // All the numeral images.
  var imgArray = new Array();

  var accumIndex = 0;
  
  // Init image array.
  var imgArrayNames = ['1E18A', '1E15A', '1E12A','1E9A', '1E6A','1000', '100',
    '90', '80', '70', '60', '50', '40', '30',
    '20', '19', '18', '17', '16', '15', '14',
    '13', '12', '11', '10',
    '9', '8', '7', '6', '5', '4', '3',
    '2', '1', '0']; 
   var imgValues = [1e18, 1e15, 1e12, 1e9, 1e6, 1000, 100,
     90, 80, 70, 60, 50, 40, 30,
     20, 19, 18, 17, 16, 15, 14,
     13, 12, 11, 10,
     9, 8, 7, 6, 5, 4, 3,
     2, 1, 0];

function initImgArray() {   
  for (i = 0; i < imgArrayNames.length; i++) {
    imgArray[i] = new Image();
    imgArray[i].src = '/images/' + 'CHR_' + imgArrayNames[i] + '.png';
    imgArray[i].numVal = imgValues[i];
  }
}

  // Calculator variables.
  // GLOBAL list of value of CHR numerals.
  var numList = [];

  // Put the new list into the output area && reset numList.
  function updateChrOutput(new_numlist) {
    clearArea("text1");
    for (var k = 0; k < new_numlist.length; k++) {
      numberClick(new_numlist[k]);
    }
  }
  
  function clearArea(area) {
	var input_area = document.getElementById(area);
	input_area.innerHtml = '';
	input_area.value = '';
	accumIndex = 0;
	x_value = 0;

	// Clear out the images.
    var imgArray = document.getElementById("img_accumulator").querySelectorAll(".accum");
    var size = imgArray.length;
    for (var i = 0; i < size; i ++) {
      imgArray[i].src = "/images/CHR_blank.png";
    }
    imgArray[0] = "/images/CHR_0.png";
    numList = [];
  }

  function addCharToImgArray(x) {
    var i = 0;
    while (imgValues[i] > 0 && imgValues[i] != x) {
      i = i + 1;
    }
    imageName = 'CHR_' + imgArrayNames[i];
  }

  function addToNumList(x) {
    numList.push(parseInt(x));
  }

  // Feeds the calculator the operations.
  function doOperator(op) {

    // New FSM (non-OOP).
    FSMstep(op, -1);

    // Old broken calculator.
    operatorSelection(op);
  }
  
  function numberClick(x) {
    // Add to the number buffer.
    
    // Use the calculator FSM.
    FSMstep(op_enter_numeral, x);
    
    // TODO: Handle 'point' specially.
    //  Add Point image to output.
    //  addToNumList(special value)
    
    var imgArray = document.getElementById("img_accumulator").querySelectorAll(".accum");
    var i = 0;
    while (imgValues[i] > 0 && imgValues[i] != x) {
      i = i + 1;
    }
    imageName = 'CHR_' + imgArrayNames[i];
    
    if (x =='point') {
      imageName = 'CHR_' + x;
      addToNumList(-10);
    } else {
	    // A normal digit.
		// Put on the num list.
		addToNumList(parseInt(x));

		// Sound file for last digit.
		//playSound(TBD);
	
		var input_area = document.getElementById('text1');
		var soFar = input_area.value;
		if (soFar == "") {
		  input_area.value = x;
		} else {
		  input_area.value = soFar + ', ' + x;
		}
    }
    imgArray[accumIndex].src = "/images/" + imageName + ".png"
    accumIndex += 1;
  }
  
  function toSequoyahs(area, area2) {
	var input_area = document.getElementById(area);
    var decimalText = input_area.value;
    if (window.XMLHttpRequest)
	  {
	  // code for IE7+, Firefox, Chrome, Opera, Safari
	  xmlhttp=new XMLHttpRequest();
	  }
	else
	  {
	  // code for IE6, IE5
	  xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
	  }
    // Deal with the results	  
    xmlhttp.onreadystatechange=function()
	{
	  if(xmlhttp.readyState==4) {
	      var returned_json = xmlhttp.responseText
		  var output_area = document.getElementById(area2);
		  var json_obj = JSON.parse(returned_json);

          output_area.innerHTML = json_obj.numeralList;
		  var new_text = json_obj.numeralList;
          // TODO: post each to the accumulator.
          output_area.value = new_text;
          
          clearArea("text1");
          for (var i = 0; i < new_text.length; i ++) {
            numberClick(new_text[i].replace("CHR_", ""));
          }
         
      }
	}
	// Set up the call to the backend.
	target = "/setDecimalNumerals/?number=" + decimalText;
	xmlhttp.open("GET", target, true);
	xmlhttp.send(null);	    
  }
  
  // Remove the last entered character in area
  function backSpace(area) {
	var input_area = document.getElementById(area);
	// clear text after the last comma.
	var text = input_area.value;
	var index = text.lastIndexOf(",");
	if (index > -1) {
	  text = text.substr(0, index);
	} else {
  	  text = "";
	}
	input_area.value = text;
    var imgArray = document.getElementById("img_accumulator").querySelectorAll(".accum");
	accumIndex = accumIndex - 1;
    imgArray[accumIndex].src = "/images/CHR_blank.png";
    
    // Recompute x_value;
    numList.pop();
    compute_X_value(numList);
  }
  
  function compute_X_value(numberList) {
    // TODO: Get the value from the digits.
    x_value = numListToInteger(numberList);
    accumArea = document.getElementById('accumulator');
    accumArea.innerHTML = x_value;
    accumArea.value = x_value;
    return x_value;	
  }

  function setLastOp(op) {
    var output_area = document.getElementById('lastOp');
    if (output_area != null) {
      output_area.value = op;
      output_area.innerHTML = op;
    }
  }

  function chrToDecimal(area1, area2) {
    // Get characters and send to backend for conversion to decimal.
	var input_area = document.getElementById(area1);
    var chrCodes = input_area.value;
    
	if (window.XMLHttpRequest)
	  {
	  // code for IE7+, Firefox, Chrome, Opera, Safari
	  xmlhttp=new XMLHttpRequest();
	  }
	else
	  {
	  // code for IE6, IE5
	  xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
	  }

    // Deal with the results	  
    xmlhttp.onreadystatechange=function()
	{
	  if(xmlhttp.readyState==4) {
	      var returned_json = xmlhttp.responseText
		  var output_area = document.getElementById(area2);
		  var json_obj = JSON.parse(returned_json);

		  var new_text = json_obj.formatted;
          output_area.innerHTML = new_text;
          output_area.value = new_text;  
     }
	}
	
	// Set up the call to the backend.
	var target = "/chrToDecimal/?chrCodes=" + chrCodes;
	xmlhttp.open("GET", target, true);
	xmlhttp.send(null);	    
  }

  function callTestChrToDec() {
  	var result = testChrToDec();
    tempOut = document.getElementById('test_output');
    tempOut.innerHTML = result;
    tempOut.value = result;
  }  

  function callTestDecToChr() {
  	var result = testDecToChr();
    tempOut = document.getElementById('test_output');
    tempOut.innerHTML = result;
    tempOut.value = result;  	
  }
  
  // Show / hide controls for testing.    
  function toggleHide(obj, newState) {
    var el = document.getElementById(obj);
    if (newState == 'off') {
      el.style.display = 'none';
      return;
    }
    if (newState == 'on') {
      el.style.display = 'block';
      return;
	}
    // Otherwise, toggle.
    if (el.style.display == 'none') {
      el.style.display = 'block';
    } else {
      el.style.display = 'none';
    }
  }
  
  function onload() {
  
     initImgArray();
     
     toggleHide('debugging', '{{debug_state}}');
     // Manage calculator.
     clearAccumState();
     
     // Finite State Machine testing.
     calcFSM = new FSM();
     calcFSM.setOutputId('testAccumulatorDiv');
     
     // Non FSM version.
     initializeFSM('testAccumulatorDiv');
  }
  </script>
  </head>
  
  <body onload="onload()">

    <h1>Cherokee Numerals</h1>

   <!- X Register: Accumulator of images ->
   <div id="img_accumulator" class="ImageBorder">
     <img src="/images/CHR_0.png" height="50" class="accum" alt="blank">
     <img src="/images/CHR_blank.png" height="50" class="accum" alt="blank">
     <img src="/images/CHR_blank.png" height="50" class="accum" alt="blank">
     <img src="/images/CHR_blank.png" height="50" class="accum" alt="blank">
     <img src="/images/CHR_blank.png" height="50" class="accum" alt="blank">
     <img src="/images/CHR_blank.png" height="50" class="accum" alt="blank">
     <img src="/images/CHR_blank.png" height="50" class="accum" alt="blank">
     <img src="/images/CHR_blank.png" height="50" class="accum" alt="blank">
     <img src="/images/CHR_blank.png" height="50" class="accum" alt="blank">
     <img src="/images/CHR_blank.png" height="50" class="accum" alt="blank">
     <img src="/images/CHR_blank.png" height="50" class="accum" alt="blank">
     <img src="/images/CHR_blank.png" height="50" class="accum" alt="blank">
     <img src="/images/CHR_blank.png" height="50" class="accum" alt="blank">
     <img src="/images/CHR_blank.png" height="50" class="accum" alt="blank">
     <img src="/images/CHR_blank.png" height="50" class="accum" alt="blank">
     <img src="/images/CHR_blank.png" height="50" class="accum" alt="blank">
     <img src="/images/CHR_blank.png" height="50" class="accum" alt="blank">
     <img src="/images/CHR_blank.png" height="50" class="accum" alt="blank">
     <img src="/images/CHR_blank.png" height="50" class="accum" alt="blank">
     <img src="/images/CHR_blank.png" height="50" class="accum" alt="blank">
     <img src="/images/CHR_blank.png" height="50" class="accum" alt="blank">
     <img src="/images/CHR_blank.png" height="50" class="accum" alt="blank">
     <img src="/images/CHR_blank.png" height="50" class="accum" alt="blank">
     <img src="/images/CHR_blank.png" height="50" class="accum" alt="blank">
   </div>
   <div id="controls">
       <textarea id="text1"  class='notosans' style='display:none; font-size: 12pt'
        rows="1" cols="80">text1</textarea>
        <input type="button" value="To decimal" onclick="chrToDecimal('text1', 'text2')" >
   </div>

<div id="container">

  <div id="keypad"> 
    <br>
    <img src="/images/CHR_0.png" height="30" onclick="numberClick(0)" class="ImageBorder" alt="0">
    <img src="/images/CHR_1.png" height="30" onclick="numberClick(1)" class="ImageBorder" alt="1">
    <img src="/images/CHR_2.png" height="30" onclick="numberClick(2)" class="ImageBorder" alt="2">
    <img src="/images/CHR_3.png" height="30" onclick="numberClick(3)" class="ImageBorder" alt="3">
    <img src="/images/CHR_4.png" height="30" onclick="numberClick(4)" class="ImageBorder" alt="4">
    <img src="/images/CHR_5.png" height="30" onclick="numberClick(5)" class="ImageBorder" alt="5">
    <img src="/images/CHR_6.png" height="30" onclick="numberClick(6)" class="ImageBorder" alt="6">
    <img src="/images/CHR_7.png" height="30" onclick="numberClick(7)" class="ImageBorder" alt="7">
    <img src="/images/CHR_8.png" height="30" onclick="numberClick(8)" class="ImageBorder" alt="8">
    <img src="/images/CHR_9.png" height="30" onclick="numberClick(9)" class="ImageBorder" alt="9">
    <br>
    <img src="/images/CHR_10.png" height="30" onclick="numberClick(10)" class="ImageBorder" alt="10">
    <img src="/images/CHR_11.png" height="30" onclick="numberClick(11)" class="ImageBorder" alt="11">
    <img src="/images/CHR_12.png" height="30" onclick="numberClick(12)" class="ImageBorder" alt="12">
    <img src="/images/CHR_13.png" height="30" onclick="numberClick(13)" class="ImageBorder" alt="13">
    <img src="/images/CHR_14.png" height="30" onclick="numberClick(14)" class="ImageBorder" alt="14">
    <img src="/images/CHR_15.png" height="30" onclick="numberClick(15)" class="ImageBorder" alt="15">
    <img src="/images/CHR_16.png" height="30" onclick="numberClick(16)" class="ImageBorder" alt="16">
    <img src="/images/CHR_17.png" height="30" onclick="numberClick(17)" class="ImageBorder" alt="17">
    <img src="/images/CHR_18.png" height="30" onclick="numberClick(18)" class="ImageBorder" alt="18">
    <img src="/images/CHR_19.png" height="30" onclick="numberClick(19)" class="ImageBorder" alt="19">
	<br>
    <img src="/images/CHR_20.png" height="30" onclick="numberClick(20)" class="ImageBorder" alt="20">
	<img src="/images/CHR_30.png" height="30" onclick="numberClick(30)" class="ImageBorder" alt="0">
    <img src="/images/CHR_40.png" height="30" onclick="numberClick(40)" class="ImageBorder" alt="40">
    <img src="/images/CHR_50.png" height="30" onclick="numberClick(50)" class="ImageBorder" alt="50">
    <img src="/images/CHR_60.png" height="30" onclick="numberClick(60)" class="ImageBorder" alt="60">
    <img src="/images/CHR_70.png" height="30" onclick="numberClick(70)" class="ImageBorder" alt="70">
    <img src="/images/CHR_80.png" height="30" onclick="numberClick(80)" class="ImageBorder" alt="80">
    <img src="/images/CHR_90.png" height="30" onclick="numberClick(90)" class="ImageBorder" alt="90">
    <img src="/images/CHR_100.png" height="30" onclick="numberClick(100)" class="ImageBorder" alt="100">
    <br>
    <img src="/images/CHR_1000.png" height="30" onclick="numberClick(1000)" class="ImageBorder" alt="1000">
    <img src="/images/CHR_1E6A.png" height="30" onclick="numberClick(1e6)" class="ImageBorder" alt="1e6">
    <img src="/images/CHR_1E9A.png" height="30" onclick="numberClick(1e9)" class="ImageBorder" alt="1e9">
    <img src="/images/CHR_1E12A.png" height="30" onclick="numberClick(1e12)" class="ImageBorder" alt="1e12">
    <img src="/images/CHR_1E15A.png" height="30" onclick="numberClick(1e15)" class="ImageBorder" alt="1e15">
    <img src="/images/CHR_1E18A.png" height="30" onclick="numberClick(1e18)" class="ImageBorder" alt="01e18">
    <img src="/images/CHR_point.png" height="30" onclick="numberClick('point')" class="ImageBorder" alt="01e18">
   <input type="button" value="delete" onclick="backSpace('text1')" >
    <input type="button" value="clear" onclick="clearArea('text1')" >
  </div>
  	
  <div id="operators">
    <br>
    <input type="button" value="+" onclick="doOperator('+')" >
    <input type="button" value="-" onclick="doOperator('-')" >
    <br>
    <input type="button" value="*" onclick="doOperator('*')" >
    <input type="button" value="/" onclick="doOperator('/')" >
    <br>
    <input type="button" value="=" onclick="doOperator('=')" >
    <br>
    <input type="button" value="clear X" onclick="doOperator('clear X')" >
    <br>
    <input type="button" value="clear A" onclick="doOperator('clear A')" >
  </div>
</div>
  	
<div class="western">
  <hr>
    <h1>Western Numerals</h1>   

          <input type="button" value="clear" onclick="clearArea('text2')" >
      <input type="button" value="to Sequoyahs" onclick="toSequoyahs('text2', 'text1')" >
    <br>
    <div id="western_digits">
      <textarea id="text2"  class='notosans'
          rows="1" cols="20">{{number}}</textarea>
    </div>
          
    <input type="button" value="Debugging" onclick="toggleHide('debugging', 'toggle')" >
    <br>
    <div id="debugging">
      <div id="temp">
        X:
        <textarea id="x"  class='notosans' style='font-size: 12pt'
          rows="1" cols="10">X: </textarea>
        Accumulator:
        <textarea id="accumulator"  class='notosans' style='font-size: 12pt'
          rows="1" cols="10">accum</textarea>
      </div>
      <br>

    <div id="test_output_group"> 
      <textarea id="test_output"  class='notosans'
          rows="1" cols="40">{{number}}</textarea>
      <br>
      
      <input type="button" value="Test 2 decimal" onclick="callTestChrToDec()" >
      <input type="button" value="Test 2 sequoah" onclick="callTestDecToChr()" >
      <input type="button" value="Test calc" onclick="runAllTests()" >
      <input type="button" value="Test key calculations" onclick="runAllCalcTests()" >
      <input type="button" value="Test calc states" onclick="runAllCalStateTests()" >

	  <br />
	  Test accumulator:
	  <div id='testAccumulatorDiv'>
      	<textarea id='testAccumOutput' class='notosans'
          rows="1" cols="20">{{number}}</textarea>
      X:  
      <textarea id='testX' class='notosans'
          rows="1" cols="20">{{number}}</textarea>
      LastOp: 
      <textarea id='lastOp' class='notosans'
          rows="1" cols="5"></textarea>	  <br />
      </div>
      <br>	  
      </div>
      TESTMSG: {{testMsg}}

    </div>
<br>

</div>

<div id="book_reference">
Learn more about Cherokee numerals in <a href="http://www.talbotlibrary.org/store/p191/Sequoyah's_Numerals_in_Cherokee_and_English.html"
    >Sequoyahs Numerals in Cherokee and English</a> by John Ross.
    </div>
</body>
</html>