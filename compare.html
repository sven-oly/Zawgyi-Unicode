<html>
  <head>
    <title>Compare strings
   </title>

  <link rel="stylesheet" type="text/css" href="/css/fonts.css">
  
   <script type="text/javascript" src="/js/shake-n-break.js">
   </script>

  <script type="text/javascript" src="/js/myzu.js">
  </script>

  <script type="text/javascript">
  function compareText(area1, area2) {
    var w1 = document.getElementById(area1);
    var w2 = document.getElementById(area2);
    var t1 = w1.value;
    var t2 = w2.value;
    
    var message;
    if ( t1.length != t2.length) {
      message = 'lengths ' + t1.length + ' <> ' + t2.length;
    } else {
      message = 'lengths: ' + t1.length + ' == ' + t2.length;
    }
    if (t1 != t2) {
      message += '  Texts are unequal.';
    }
    var s1 = t1.split('/[ \u104a\u104b\u100a0]/');
    var s2 = t2.split('/[ \u104a\u104b\u100a0]/');
    if (s1.length != s2.length) {
      message += '\nWords ' + s1.length + ' <> ' + s2.length;
    } else {
      message += '\nWords: ' + s1.length + ' == ' + s2.length;
    }

    var ndiffs = 0;
    for (i = 0; i < s1.length; i++) {
      if (i < s1.length) {
        if (s1[i] != s2[i]) {
          message += '\n  Words # ' + i +  ':\n' + s1[i] + '\n -----------------\n ' + s2[i];
          ndiffs += 1;
        }
      }    
    }
    if (ndiffs == 0) {
      message += '\nNo different words.';
    } else {
      message += '\n' + ndiffs + ' different words.';
    }

    var m1 = document.getElementById('diffinfo');
    m1.value = message;
  }
  
  function hexBytesToOutput(area1, area2) {
    // Prepare for the call to the backendvar xmlhttp;
	var input_area = document.getElementById(area1);
    var hexByteText = input_area.value;
    
	if (window.XMLHttpRequest)
	  {
	  // code for IE7+, Firefox, Chrome, Opera, Safari
	  xmlhttp=new XMLHttpRequest();
	  }
	else
	  {
	  // code for IE6, IE5
	  xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
	  }

    // Deal with the results	  
    xmlhttp.onreadystatechange=function()
	{
	  if(xmlhttp.readyState==4) {
	      var returned_json = xmlhttp.responseText
		  var output_area = document.getElementById(area2);
		  var json_obj = JSON.parse(returned_json);
		  // alert(json_obj.converted);

          output_area.innerHTML = json_obj.converted;
		  var hex_area = document.getElementById(area2);
		  var new_text = json_obj.converted;
          hex_area.value = textToHex(new_text);  
     }
	}
	
	// Set up the call to the backend.
	target = "/convertBtoC/?text=" + hexByteText;
	xmlhttp.open("GET", target, true);
	xmlhttp.send(null);	    
  }
  
  function fillHex(area_name, textsource) {
    var text_area = document.getElementById(textsource);
    var hex_area = document.getElementById(area_name);
    hex_area.value = textToHex(text_area.value);
  }
  
document.onreadystatechange = function(){
  if(document.readyState === 'complete'){
    fillHex('text1_hex', 'text1');
    fillHex('text2_hex', 'text2');
    compareText('text1', 'text2');
  }
}

  function onload() {
  }
  
  </script>
  </head>
  
  <body onload="onload()">

    <h1>Text 1</h1>
    <p>
    <div>
      <textarea id="text1"  class='notosans'
        rows="4" cols="40">{{t1}}</textarea>
      Text 1
      <div id="t1_hex">
            <textarea  id="text1_hex"  class='notosans' style="font-size:14;"
        rows="2" cols="80" />Hex2</textarea>
        </div>
     </div>
     <input type="button" value="Convert" onclick="hexToOutput('text1', 'text1')" />
 
   <h1>Text 2</h1>   
    <div>
      <textarea id="text2"  class='notosans'
        rows="4" cols="40">{{t2}}</textarea>
      Text 2
        <div id="t2_hex">
            <textarea id="text2_hex"  class='notosans' style="font-size:14;"
        rows="2" cols="80">Hex1</textarea>
        </div>
    </div>
         <input type="button" value="hex to text" onclick="hexToOutput('text2', 'text2')" />

    
    <form action="/feedback" method="get">
      <input type="submit" value="Send feedback" />
    </form>  
    
    <textarea id="diffinfo" rows="4" cols="80" style="font-size:14;">diffinfo</textarea>
  </body>
</html>